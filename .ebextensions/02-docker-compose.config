# 환경변수 참고 : https://docs.aws.amazon.com/ko_kr/elasticbeanstalk/latest/dg/custom-platforms-scripts.html
# 환경변수 참고 2 : https://github.com/search?q=repo%3Aawsdocs%2Felastic-beanstalk-samples+get-config&type=code
# source /opt/elasticbeanstalk/support/envvars
# HS512_SECRET="$(/opt/elasticbeanstalk/bin/get-config environment -k HS512_SECRET)"
# DOCKERHUB_USERNAME="$(/opt/elasticbeanstalk/bin/get-config environment -k DOCKERHUB_USERNAME)"
# TAG_VERSION="$(/opt/elasticbeanstalk/bin/get-config environment -k TAG_VERSION)"

# HS512_SECRET=$HS512_SECRET \
# DOCKERHUB_USERNAME=$DOCKERHUB_USERNAME \
# TAG_VERSION=$TAG_VERSION \
            
files:
    "/sbin/appstart":
        mode: "000755"
        owner: webapp
        group: webapp
        content: |  
            #!/bin/bash
            YML_PATH=/var/app/current/docker-compose.yml
            sudo COMPOSE_DOCKER_CLI_BUILD=1 DOCKER_BUILDKIT=1 docker-compose -p my-app -f $YML_PATH up
